# The name of your workflow. GitHub displays the names of your workflows on your repository's actions page. 
# If you omit name, GitHub sets it to the workflow file path relative to the root of the repository.
name: Golang CI

# This workflow is triggered on push to default branch and on pull reqeusts to default branch.
on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  # Set the job key. The key is displayed as the job name
  # when a job name is not provided
  # The job key is "build-and-test"
  build-and-test:
  
    # Job name is "Build and test"
    name: Build and test
    
    # This job runs on Ubuntu-latest
    runs-on: ubuntu-latest
    
    steps:
      # This action sets up a go environment for use in actions by:
      #     optionally downloading and caching a version of Go by version and adding to PATH
      #     registering problem matchers for error output
      # This step uses GitHub's setup-go: https://github.com/actions/setup-go
      - name: Set up Go 1.x
        uses: actions/setup-go@v3
        with:
          go-version: ^1.18
        id: go
        
      # This action checks-out your repository under $GITHUB_WORKSPACE, so your workflow can access it.
      # This step uses GitHub's checkout: https://github.com/actions/checkout
      - name: Check out code into the Go module directory
        uses: actions/checkout@v3

      # This step installs dependencies
      - name: Get dependencies
        run: |
          go get -v -t -d ./...
          if [ -f Gopkg.toml ]; then
              curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh
              dep ensure
          fi
          
      # This step builds source codes
      - name: Build
        run: go build -v .

      # This step performs unit tests specified.
      - name: Test
        run: go test -v .
